{% extends 'base.html' %}


<!--

    on the left side we're listing the issues
    - grouped by projects / or by a custom group

    on the right side we're displaying the issues data

    We also gonna need a form to create / add an issue
    - on creating the issues we're going the get the tags and labels
    - from the source that this issues is posted
        - if it is from a code "posting" platform
        - or we let the user who created this issues add the tags and labels too

    Matching Tags (issues, users) will be hightlighted


{ block list
    { block issue (one block)
        - title
        - tags (can be limited)
    }
    e.g
        Can't set the cookies
        [#python] [#fastapi] [#cookies] ...
}


[ filters   [ projects      [ issues    [ issue
            |               |           |   { BLOCK }
            |               |           |
            ]               ]           ]       Chat]
-->



<!-- v0.1.0

- [x] Just list the created / added issues

-->


{% block nav_center %}
  {% if user %}
  <a href="{{ url_for('get_issues_create') }}">Create Issue</a>
  {% endif %}
{% endblock %}


{% block body %}
{% if error_message %}
<h5 style="margin-bottom: 0px; text-align: center;">{{ error_message }}</h5>
{% endif %}
<div class="container" style="display: flex;">
  <div class="filters" style="margin-top: 16px; margin-bottom: 16px;">
    <form
      action="{{ url_for('post_issues') }}"
      method="POST"
      style="display: inline-grid; min-width: 200px;"
    >
      <input
        name="title"
        placeholder="Filter by Tittle"
        autocomplete="off"
        {% if filters.title %}
        value="{{ filters.title }}"
        {% endif %}
      />
      <input
        name="tags"
        placeholder="Filter by Tags"
        autocomplete="off"
        {% if filters.tags %}
        value="{{ filters.tags }}"
        {% endif %}
      />
      <input
        name="labels"
        placeholder="Filter by Labels"
        autocomplete="off"
        {% if filters.labels %}
        value="{{ filters.labels }}"
        {% endif %}
      />
      <input
        name="id"
        placeholder="Filter by Id"
        autocomplete="off"
        {% if filters.id %}
        value="{{ filters.id }}"
        {% endif %}
      />
      <input
        name="created_by"
        placeholder="Filter by CreatorId"
        autocomplete="off"
        {% if filters.created_by %}
        value="{{ filters.created_by }}"
        {% endif %}
      />
      <input type="submit" value="Submit Filter Query" />
    </form>
  </div>
  <div class="projects"></div>
  <div class="issues">
    <ul>
      {% for issue in issues %}
      <li onclick="openIssuesData(this, '{{ issue.id }}');">
        {{ issue.title }}</br>
        {% for tag in issue.categories.tags %}
        {% if user and tag in user.tags %}
        <span class="tag-hl">#{{ tag }}</span>
        {% else %}
        <span class="tag-hl">#{{ tag }}</span>
        {% endif %}
        {% endfor %}
      </li>
      {% endfor %}
    </ul>
  </div>
  <div class="issues-data">
    {% for issue in issues %}
    <div id="issues-{{ issue.id }}-data" style="display: none;">
      <p>
        <span>#{{ issue.id }} - Id</span>
        <br />
        <span>#{{ issue.created_by }} - CreatorId</span>
        {% if user and user.id == issue.createed_by %}
        <br />
        <a href="{{ url_for('get_issues_delete', issue_id=issue.id) }}"><button>Delete</button></a>
        <a href="{{ url_for('get_issues_update', issue_id=issue.id) }}"><button>Update</button></a>
        {% endif %}
      </p>
      <p><a href="{{ issue.url }}">{{ issue.url }}</a></p>
      <p>{{ issue.title }} </p>
      {% if issue.description %}
      <p>{{ issue.description }}</p>
      {% endif %}
      <p>
        {% for tag in issue.categories.tags %}
        {% if user and tag in user.tags %}
        <span class="tag-hl">#{{ tag }}</span>
        {% else %}
        <span class="tag-hl">#{{ tag }}</span>
        {% endif %}
        {% endfor %}
      </p>
      <p>
        {% for label in issue.categories.labels %}
        <span>{{ label }}</span>
        {% endfor %}
      </p>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}


{% block script %}
<script>
  var prevIssue = null;
  var prevIssueData = null;
  function openIssuesData(issue, issueId) {
    if (prevIssue !== null) {
      prevIssue.style.border = "";
    }
    if (prevIssueData !== null) {
      prevIssueData.style.display = "none";
    }
    const issueData = document.getElementById("issues-" + issueId + "-data");
    issue.style.border = "1px solid palegreen";
    issueData.style.display = "";
    prevIssue = issue;
    prevIssueData = issueData;
  }
</script>
{% endblock %}